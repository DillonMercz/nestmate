<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, minimal-ui, viewport-fit=cover">
    <meta name="theme-color" content="#2196f3">
    <meta name="author" content="Nestmate" />
    <meta name="keywords" content="" />
    <meta name="robots" content="" />
    <meta name="title" content="NestMate Home Services - Book Now">
    <meta name="description" content="Book Home Services With A Tap.">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://metatags.io/">
    <meta property="og:title" content="NestMate Home Services - Book Now">
    <meta property="og:description" content="Book Home Services With A Tap.">
    <meta property="og:image" content="https://i.imgur.com/LxRcNqE.png">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://metatags.io/">
    <meta property="twitter:title" content="NestMate Home Services - Book Now">
    <meta property="twitter:description" content="Book Home Services With A Tap.">
    <meta property="twitter:image" content="https://i.imgur.com/LxRcNqE.png">
    <meta name="description" content="NestMate - Services ">
    <meta name="format-detection" content="telephone=no">
    <!-- Favicons Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.ico" />
    <!-- Title -->
    <title>NestMate Home Services</title>
    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/vendor/swiper/swiper-bundle.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>

<body data-theme-color="color-yellow">
    <div class="page-wraper">
        <!-- Preloader -->
        <div id="preloader">
            <div class="spinner"></div>
        </div>
        <!-- Preloader end-->
        <!-- Header -->
        <header class="header">
            <div class="main-bar">
                <div class="container">
                    <div class="header-content">
                        <div class="left-content">
                            <a href="javascript:void(0);" class="back-btn">
                                <svg width="18" height="18" viewBox="0 0 10 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9.03033 0.46967C9.2966 0.735936 9.3208 1.1526 9.10295 1.44621L9.03033 1.53033L2.561 8L9.03033 14.4697C9.2966 14.7359 9.3208 15.1526 9.10295 15.4462L9.03033 15.5303C8.76406 15.7966 8.3474 15.8208 8.05379 15.6029L7.96967 15.5303L0.96967 8.53033C0.703403 8.26406 0.679197 7.8474 0.897052 7.55379L0.96967 7.46967L7.96967 0.46967C8.26256 0.176777 8.73744 0.176777 9.03033 0.46967Z" fill="#a19fa8" />
                                </svg>
                            </a>
                        </div>
                        <div class="mid-content">
                            <h5 class="mb-0">Messages</h5>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Header End -->
        <!-- Page Content -->
        <div class="page-content fb">
            <div class="container pb-0">
                <div class="input-group input-search">
                    <span class="input-group-text">
                        <a href="javascript:void(0);" class="search-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M20.5605 18.4395L16.7528 14.6318C17.5395 13.446 18 12.0262 18 10.5C18 6.3645 14.6355 3 10.5 3C6.3645 3 3 6.3645 3 10.5C3 14.6355 6.3645 18 10.5 18C12.0262 18 13.446 17.5395 14.6318 16.7528L18.4395 20.5605C19.0245 21.1462 19.9755 21.1462 20.5605 20.5605C21.1462 19.9748 21.1462 19.0252 20.5605 18.4395ZM5.25 10.5C5.25 7.605 7.605 5.25 10.5 5.25C13.395 5.25 15.75 7.605 15.75 10.5C15.75 13.395 13.395 15.75 10.5 15.75C7.605 15.75 5.25 13.395 5.25 10.5Z" fill="#B9B9B9"></path>
                            </svg>
                        </a>
                    </span>
                    <input type="text" id="myInput" placeholder="Search job here..." class="form-control bs-0 ps-0">
                </div>
            </div>
            <div class="container pt-0">
                <!-- Masseges List -->
                <ul class="dz-list message-list" style="padding-bottom:0px">
                    <li class="contact-support">
                        <a href="javascript:void(0);" onclick="contactNestmateSupport()">
                            <div class="media media-45 rounded-circle">
                                <img src="https://i.imgur.com/LxRcNqE.png" alt="Nestmate Support Icon">
                            </div>
                            <div class="media-content">
                                <div>
                                    <h6 class="name">Contact Nestmate Support</h6>
                                    <p>Click here to get in touch with our support team.</p>
                                </div>
                                <div class="support-arrow">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="transform: rotate(180deg);">
                                        <path d="M9.03033 0.46967C9.2966 0.735936 9.3208 1.1526 9.10295 1.44621L9.03033 1.53033L2.561 8L9.03033 14.4697C9.2966 14.7359 9.3208 15.1526 9.10295 15.4462L9.03033 15.5303C8.76406 15.7966 8.3474 15.8208 8.05379 15.6029L7.96967 15.5303L0.96967 8.53033C0.703403 8.26406 0.679197 7.8474 0.897052 7.55379L0.96967 7.46967L7.96967 0.46967C8.26256 0.176777 8.73744 0.176777 9.03033 0.46967Z" fill="#a19fa8" />
                                    </svg>
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
                <ul class="dz-list message-list" id="conversationsList">
                </ul>
                <a href="javascript:void(0);" class="btn scrollTop btn-primary btn-rounded px-3 chat-btn"><i class="fa-solid fa-plus me-2"></i> New Chat</a>
            </div>
        </div>
        <!-- Page Content End-->
        <!-- Menubar -->
        <div class="menubar-area">
            <div class="toolbar-inner menubar-nav">
                <a href="search.html" class="nav-link">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9.14373 20.7821V17.7152C9.14372 16.9381 9.77567 16.3067 10.5584 16.3018H13.4326C14.2189 16.3018 14.8563 16.9346 14.8563 17.7152V20.7732C14.8562 21.4473 15.404 21.9951 16.0829 22H18.0438C18.9596 22.0023 19.8388 21.6428 20.4872 21.0007C21.1356 20.3586 21.5 19.4868 21.5 18.5775V9.86585C21.5 9.13139 21.1721 8.43471 20.6046 7.9635L13.943 2.67427C12.7785 1.74912 11.1154 1.77901 9.98539 2.74538L3.46701 7.9635C2.87274 8.42082 2.51755 9.11956 2.5 9.86585V18.5686C2.5 20.4637 4.04738 22 5.95617 22H7.87229C8.19917 22.0023 8.51349 21.8751 8.74547 21.6464C8.97746 21.4178 9.10793 21.1067 9.10792 20.7821H9.14373Z" fill="#130F26" />
                    </svg>
                </a>
                <a href="my-jobs.html" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 512 512">
                        <path d="M469.3 19.3l23.4 23.4c25 25 25 65.5 0 90.5l-56.4 56.4L322.3 75.7l56.4-56.4c25-25 65.5-25 90.5 0zM44.9 353.2L299.7 98.3 413.7 212.3 158.8 467.1c-6.7 6.7-15.1 11.6-24.2 14.2l-104 29.7c-8.4 2.4-17.4 .1-23.6-6.1s-8.5-15.2-6.1-23.6l29.7-104c2.6-9.2 7.5-17.5 14.2-24.2zM249.4 103.4L103.4 249.4 16 161.9c-18.7-18.7-18.7-49.1 0-67.9L94.1 16c18.7-18.7 49.1-18.7 67.9 0l19.8 19.8c-.3 .3-.7 .6-1 .9l-64 64c-6.2 6.2-6.2 16.4 0 22.6s16.4 6.2 22.6 0l64-64c.3-.3 .6-.7 .9-1l45.1 45.1zM408.6 262.6l45.1 45.1c-.3 .3-.7 .6-1 .9l-64 64c-6.2 6.2-6.2 16.4 0 22.6s16.4 6.2 22.6 0l64-64c.3-.3 .6-.7 .9-1L496 350.1c18.7 18.7 18.7 49.1 0 67.9L417.9 496c-18.7 18.7-49.1 18.7-67.9 0l-87.4-87.4L408.6 262.6z" fill="#a19fa8" /></svg>
                </a>
                <a href="messages.html" class="nav-link active">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path opacity="0.4" d="M22 15.9403C22 18.7303 19.76 20.9903 16.97 21.0003H16.96H7.05C4.27 21.0003 2 18.7503 2 15.9603V15.9503C2 15.9503 2.006 11.5243 2.014 9.2983C2.015 8.8803 2.495 8.6463 2.822 8.9063C5.198 10.7913 9.447 14.2283 9.5 14.2733C10.21 14.8423 11.11 15.1633 12.03 15.1633C12.95 15.1633 13.85 14.8423 14.56 14.2623C14.613 14.2273 18.767 10.8933 21.179 8.9773C21.507 8.7163 21.989 8.9503 21.99 9.3673C22 11.5763 22 15.9403 22 15.9403Z" fill="#a19fa8" />
                        <path d="M21.4761 5.67369C20.6101 4.04169 18.9061 2.99969 17.0301 2.99969H7.05013C5.17413 2.99969 3.47013 4.04169 2.60413 5.67369C2.41013 6.03869 2.50213 6.4937 2.82513 6.75169L10.2501 12.6907C10.7701 13.1107 11.4001 13.3197 12.0301 13.3197C12.0341 13.3197 12.0371 13.3197 12.0401 13.3197C12.0431 13.3197 12.0471 13.3197 12.0501 13.3197C12.6801 13.3197 13.3101 13.1107 13.8301 12.6907L21.2551 6.75169C21.5781 6.4937 21.6701 6.03869 21.4761 5.67369Z" fill="#a19fa8" />
                    </svg>
                </a>
                <a href="links.html" class="nav-link">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path opacity="0.4" d="M16.0755 2H19.4615C20.8637 2 22 3.14585 22 4.55996V7.97452C22 9.38864 20.8637 10.5345 19.4615 10.5345H16.0755C14.6732 10.5345 13.537 9.38864 13.537 7.97452V4.55996C13.537 3.14585 14.6732 2 16.0755 2Z" fill="#a19fa8" />
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.53852 2H7.92449C9.32676 2 10.463 3.14585 10.463 4.55996V7.97452C10.463 9.38864 9.32676 10.5345 7.92449 10.5345H4.53852C3.13626 10.5345 2 9.38864 2 7.97452V4.55996C2 3.14585 3.13626 2 4.53852 2ZM4.53852 13.4655H7.92449C9.32676 13.4655 10.463 14.6114 10.463 16.0255V19.44C10.463 20.8532 9.32676 22 7.92449 22H4.53852C3.13626 22 2 20.8532 2 19.44V16.0255C2 14.6114 3.13626 13.4655 4.53852 13.4655ZM19.4615 13.4655H16.0755C14.6732 13.4655 13.537 14.6114 13.537 16.0255V19.44C13.537 20.8532 14.6732 22 16.0755 22H19.4615C20.8637 22 22 20.8532 22 19.44V16.0255C22 14.6114 20.8637 13.4655 19.4615 13.4655Z" fill="#a19fa8" />
                    </svg>
                </a>
            </div>
        </div>
        <!-- Menubar -->
    </div>
    <!--**********************************
    Scripts
***********************************-->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/settings.js"></script>
    <script src="assets/js/custom.js"></script>
    <script src="assets/js/dz.carousel.js"></script><!-- Swiper -->
    <script src="assets/vendor/swiper/swiper-bundle.min.js"></script><!-- Swiper -->
    <script>
    $(document).ready(function() {
        $("#myInput").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $(".message-list li").filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-analytics-compat.js"></script>
    <script>
    var currentUserEmail
    var template = ""
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var currentUserEmail
    const firebaseConfig = {
        apiKey: "AIzaSyBd9mTGo1lM19_Kcqf_vl7-pE4Rq1AzWA8",
        authDomain: "bookings-49c4e.firebaseapp.com",
        projectId: "bookings-49c4e",
        storageBucket: "bookings-49c4e.appspot.com",
        messagingSenderId: "491340380786",
        appId: "1:491340380786:web:50ea0578b31309494ae0eb",
        measurementId: "G-3JJKPRCD9Y"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics()

    // Get a reference to the Firestore database
    const db = firebase.firestore();

    // Get the current user's email (replace with your actual code to retrieve the user's email)
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            // User is signed in, show their name
            currentUserEmail = user.email;
            // Fetch messages when the page loads
            fetchMessages();

        } else {
            // No user is signed in, show login button
            console.log("No User Found")
            window.location.href = "./login.html";

        }
    });
    // Function to fetch messages for the current user's email
    function fetchMessages() {
        db.collection('messaging')
            .where('users', 'array-contains', currentUserEmail)
            .get()
            .then((snapshot) => {
                const conversations = snapshot.docs.map((doc) => {
                    console.log(doc.id)
                    const data = doc.data();
                    template += `<li>
                    <a onclick="window.localStorage.setItem('conversationID', '${doc.id}'); window.location.href='./messages-detail.html'"style="cursor:pointer">
                        <div class="media media-45 rounded-circle">
                            <img src="https://i.imgur.com/LxRcNqE.png" alt="image">
                        </div>
                        <div class="media-content">
                            <div>
                                <h6 class="name">${doc.data().name}</h6>

                            </div>
                            </div>
                    </a>
                </li>`
                    console.log(data)
                    return doc.id;
                });

                document.getElementById("conversationsList").innerHTML = template
                console.log('Conversations:', conversations); // Log the array of conversations
            })
    }

    function contactNestmateSupport() {
        // Get the current user's email (replace with your actual code to retrieve the user's email)

        // Create a new Firebase document with the specified fields
        db.collection("messaging")
            .add({
                users: ["Dylanclayton3@gmail.com", "Elev8.cards@gmail.com", currentUserEmail],
                name: "Nestmate Support",
            })
            .then((docRef) => {
                // Document created successfully
                console.log("Document written with ID: ", docRef.id);
                // You can perform any other actions or display success messages here
                window.localStorage.setItem('conversationID', docRef.id); 
                window.location.href='./messages-detail.html'
            })
            .catch((error) => {
                // Error handling if document creation fails
                console.error("Error adding document: ", error);
                // You can display error messages or handle the error as needed
            });
    }

    // Chat button
    var handleChatBox = function() {
        $('.btn-chat').on('click', function() {

            var chatInput = $('.message-area .form-control');
            var chatMessageValue = chatInput.val();
            console.log(chatMessageValue)

            var chatEmojiArea = $('.append-media').html();

            var current = new Date();
            var ampm = current.getHours() >= 12 ? 'pm' : 'am';
            var actualTime = (current.getHours() % 12 + ':' + current.getMinutes() + ' ' + ampm);

            var messageEmojiHtml = '<div class="chat-content user">' +
                '<div class="message-item">' +
                '<div class="bubble">' + chatEmojiArea + '</div>' +
                '<div class="message-time">' + actualTime + '</div>' +
                '</div>' +
                '</div>';

            if (chatEmojiArea.length > 0) {
                $('.chat-box-area').append(messageEmojiHtml);
            }

            var messageHtml = '<div class="chat-content user">' +
                '<div class="message-item">' +
                '<div class="bubble">' + chatMessageValue + '</div>' +
                '<div class="message-time">' + actualTime + '</div>' +
                '</div>' +
                '</div>';

            if (chatMessageValue.length > 0) {
                var appendMessage = $('.chat-box-area').append(messageHtml);
                // Add the message to the conversation's messaging history
                //addMessageToHistory(chatMessageValue);

            }

            window.scrollTo(0, document.body.scrollHeight);
            var clearChatInput = chatInput.val('');
            var clearChatInputE = $('.append-media').empty();
        });
    }
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            // User is signed in, show their name
            var name = user.displayName;
            document.getElementById("user-name").innerHTML = name;
        } else {
            // No user is signed in, show login button
            console.log("No User Found")
            //window.location.href="./register.html"


        }
    });
    </script>
</body>

</html>